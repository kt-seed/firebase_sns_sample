# Supabase ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Anonymous SNSãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Supabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šç”¨ã®SQLãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ“Š ERå›³ï¼ˆEntity Relationship Diagramï¼‰

```mermaid
erDiagram
    users ||--o{ posts : "ä½œæˆã™ã‚‹"
    users ||--o{ likes : "ã„ã„ã­ã™ã‚‹"
    users ||--o{ reposts : "ãƒªãƒã‚¹ãƒˆã™ã‚‹"
    users ||--o{ follows : "ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ï¼ˆfollowerï¼‰"
    users ||--o{ follows : "ãƒ•ã‚©ãƒ­ãƒ¼ã•ã‚Œã‚‹ï¼ˆfollowingï¼‰"
    posts ||--o{ likes : "ã„ã„ã­ã•ã‚Œã‚‹"
    posts ||--o{ reposts : "ãƒªãƒã‚¹ãƒˆã•ã‚Œã‚‹"

    users {
        uuid id PK "auth.users.idã¨åŒä¸€"
        text email UK "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä¸€æ„ï¼‰"
        text display_name "è¡¨ç¤ºå"
        text icon "ã‚¢ã‚¤ã‚³ãƒ³IDï¼ˆicon-catç­‰ï¼‰"
        text bio "è‡ªå·±ç´¹ä»‹"
        timestamp created_at "ä½œæˆæ—¥æ™‚"
        timestamp updated_at "æ›´æ–°æ—¥æ™‚"
    }

    posts {
        uuid id PK "æŠ•ç¨¿ID"
        uuid user_id FK "ä½œæˆè€…ï¼ˆusers.idï¼‰"
        text text "æŠ•ç¨¿æœ¬æ–‡ï¼ˆ280æ–‡å­—ä»¥å†…ï¼‰"
        int likes_count "ã„ã„ã­æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0ï¼‰"
        int reposts_count "ãƒªãƒã‚¹ãƒˆæ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ0ï¼‰"
        timestamp created_at "ä½œæˆæ—¥æ™‚"
    }

    likes {
        uuid id PK "ã„ã„ã­ID"
        uuid user_id FK "ã„ã„ã­ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆusers.idï¼‰"
        uuid post_id FK "ã„ã„ã­å¯¾è±¡ã®æŠ•ç¨¿ï¼ˆposts.idï¼‰"
        timestamp created_at "ä½œæˆæ—¥æ™‚"
    }

    reposts {
        uuid id PK "ãƒªãƒã‚¹ãƒˆID"
        uuid user_id FK "ãƒªãƒã‚¹ãƒˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆusers.idï¼‰"
        uuid post_id FK "ãƒªãƒã‚¹ãƒˆå¯¾è±¡ã®æŠ•ç¨¿ï¼ˆposts.idï¼‰"
        timestamp created_at "ä½œæˆæ—¥æ™‚"
    }

    follows {
        uuid id PK "ãƒ•ã‚©ãƒ­ãƒ¼ID"
        uuid follower_id FK "ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹å´ï¼ˆusers.idï¼‰"
        uuid following_id FK "ãƒ•ã‚©ãƒ­ãƒ¼ã•ã‚Œã‚‹å´ï¼ˆusers.idï¼‰"
        timestamp created_at "ä½œæˆæ—¥æ™‚"
    }
```

### ERå›³ã®èª­ã¿æ–¹

- **users**: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’ä¿å­˜ï¼ˆ`auth.users`ã¨1å¯¾1å¯¾å¿œï¼‰
- **posts**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã—ãŸæŠ•ç¨¿
- **likes**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æŠ•ç¨¿ã®å¤šå¯¾å¤šé–¢ä¿‚ï¼ˆã„ã„ã­æ©Ÿèƒ½ï¼‰
- **reposts**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æŠ•ç¨¿ã®å¤šå¯¾å¤šé–¢ä¿‚ï¼ˆãƒªãƒã‚¹ãƒˆæ©Ÿèƒ½ï¼‰
- **follows**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åŒå£«ã®å¤šå¯¾å¤šé–¢ä¿‚ï¼ˆãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½ï¼‰

### ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—

| ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | ç¨®é¡ | èª¬æ˜ |
|------------|------|------|
| users â†’ posts | 1å¯¾å¤š | 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®æŠ•ç¨¿ã‚’ä½œæˆå¯èƒ½ |
| users â†’ likes | 1å¯¾å¤š | 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®æŠ•ç¨¿ã«ã„ã„ã­å¯èƒ½ |
| posts â†’ likes | 1å¯¾å¤š | 1ã¤ã®æŠ•ç¨¿ã¯è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã„ã„ã­ã•ã‚Œã‚‹ |
| users â†’ reposts | 1å¯¾å¤š | 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®æŠ•ç¨¿ã‚’ãƒªãƒã‚¹ãƒˆå¯èƒ½ |
| posts â†’ reposts | 1å¯¾å¤š | 1ã¤ã®æŠ•ç¨¿ã¯è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ãƒªãƒã‚¹ãƒˆã•ã‚Œã‚‹ |
| users â†’ follows (follower) | 1å¯¾å¤š | 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ•ã‚©ãƒ­ãƒ¼å¯èƒ½ |
| users â†’ follows (following) | 1å¯¾å¤š | 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚©ãƒ­ãƒ¼ã•ã‚Œã‚‹ |

## ğŸ“‹ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯**å¿…ãšé †ç•ªé€šã‚Š**ã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### 1. `001_initial_schema.sql` - åˆæœŸã‚¹ã‚­ãƒ¼ãƒ
**æ¦‚è¦**: åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
- `users` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
- `posts` - æŠ•ç¨¿
- `likes` - ã„ã„ã­
- `reposts` - ãƒªãƒã‚¹ãƒˆ
- `follows` - ãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚

**å®Ÿè¡Œæ–¹æ³•**:
1. Supabase Dashboard â†’ SQL Editor
2. ã€ŒNew Queryã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. `001_initial_schema.sql`ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘
4. ã€ŒRunã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### 2. `002_add_indexes.sql` - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
**æ¦‚è¦**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
- æŠ•ç¨¿ã®æ¤œç´¢é€Ÿåº¦å‘ä¸Š
- ã„ã„ã­ãƒ»ãƒªãƒã‚¹ãƒˆã®é›†è¨ˆé€Ÿåº¦å‘ä¸Š
- ãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚ã®æ¤œç´¢é€Ÿåº¦å‘ä¸Š

**å®Ÿè¡Œæ–¹æ³•**:
1. Supabase Dashboard â†’ SQL Editor
2. ã€ŒNew Queryã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. `002_add_indexes.sql`ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘
4. ã€ŒRunã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### 3. `003_rls_policies.sql` - Row Level Security
**æ¦‚è¦**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®è¨­å®š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã¿ç·¨é›†å¯èƒ½
- èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿æŠ•ç¨¿ãƒ»ã„ã„ã­ãƒ»ãƒªãƒã‚¹ãƒˆãƒ»ãƒ•ã‚©ãƒ­ãƒ¼å¯èƒ½
- è‡ªåˆ†ãŒä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã®ã¿å‰Šé™¤å¯èƒ½

**å®Ÿè¡Œæ–¹æ³•**:
1. Supabase Dashboard â†’ SQL Editor
2. ã€ŒNew Queryã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. `003_rls_policies.sql`ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘
4. ã€ŒRunã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### 4. `004_views_and_functions.sql` - ãƒ“ãƒ¥ãƒ¼ãƒ»é–¢æ•°
**æ¦‚è¦**: ä¾¿åˆ©ãªãƒ“ãƒ¥ãƒ¼ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®ä½œæˆ
- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç”¨ãƒ“ãƒ¥ãƒ¼
- ã„ã„ã­ãƒ»ãƒªãƒã‚¹ãƒˆæ•°ã®å¢—æ¸›é–¢æ•°
- ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ãƒ»ãƒ•ã‚©ãƒ­ãƒ¼æ•°å–å¾—é–¢æ•°

**å®Ÿè¡Œæ–¹æ³•**:
1. Supabase Dashboard â†’ SQL Editor
2. ã€ŒNew Queryã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. `004_views_and_functions.sql`ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘
4. ã€ŒRunã€ã‚’ã‚¯ãƒªãƒƒã‚¯

## âœ… å®Ÿè¡Œç¢ºèª

ã™ã¹ã¦ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

### ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèª
Supabase Dashboard â†’ Table Editor ã§ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
- âœ… users
- âœ… posts
- âœ… likes
- âœ… reposts
- âœ… follows

### RLSã®ç¢ºèª
å„ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã€ŒRLS enabledã€ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚

### é–¢æ•°ã®ç¢ºèª
Supabase Dashboard â†’ Database â†’ Functions ã§ä»¥ä¸‹ã®é–¢æ•°ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
- âœ… increment_likes_count
- âœ… decrement_likes_count
- âœ… increment_reposts_count
- âœ… decrement_reposts_count
- âœ… get_followers_count
- âœ… get_following_count
- âœ… user_liked_posts

## ğŸ”„ Realtimeæœ‰åŠ¹åŒ–

ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§Realtimeã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ï¼š

1. Supabase Dashboard â†’ Database â†’ Replication
2. ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®Realtimeã‚’æœ‰åŠ¹åŒ–ï¼š
   - âœ… posts
   - âœ… likes
   - âœ… reposts
   - âœ… follows

## ğŸ” Authenticationè¨­å®š

1. Supabase Dashboard â†’ Authentication â†’ Providers
2. Email Providerã®è¨­å®šã‚’ç¢ºèªãƒ»å¤‰æ›´ï¼š
   - **Enable Email provider**: ON
   - **Confirm email**: **OFF**ï¼ˆé‡è¦ï¼ï¼‰
   - **Secure email change**: ON

## ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

é–‹ç™ºç”¨ã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®SQLã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```sql
-- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆï¼ˆã¾ãšSupabase Authã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¦ã‹ã‚‰å®Ÿè¡Œï¼‰
-- æ³¨æ„: ã“ã®ä¾‹ã®UUIDã¯å®Ÿéš›ã®auth.usersã®IDã«ç½®ãæ›ãˆã¦ãã ã•ã„

-- ãƒ†ã‚¹ãƒˆæŠ•ç¨¿
INSERT INTO posts (user_id, text) VALUES
  ('your-user-id-here', 'ã“ã‚Œã¯æœ€åˆã®ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã§ã™ï¼'),
  ('your-user-id-here', 'Supabase + Vue.jsã§SNSã‚’ä½œã£ã¦ã„ã¾ã™ã€‚');
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [Supabaseå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://supabase.com/docs)
- [PostgreSQL RLS](https://supabase.com/docs/guides/auth/row-level-security)
- [Supabase Realtime](https://supabase.com/docs/guides/realtime)
